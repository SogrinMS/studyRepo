<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<script type="text/javascript" src="vis.min.js"></script>
	<link rel="stylesheet" href="vis.min.css">
	<title></title>
</head>
<body>
	<div id="or-graph" style="width: 90vw; height: 100vh">

	</div>
	<script>
		var string = prompt('Введите выражение через пробел');
		corrrectInput(string, /[a-zA-Zа-яА-ЯёЁ]+/);
		var arr = string.split(' ');
		var result = 0, start = 0, index = 1;
		var flag = false, firstLoop = true;
		var helperVisJsArray = new Array();
		
		if (isNaN(Number(arr[0]))) {
			//первые операторы
			for (var i = 0; i < arr.length; i++) {
				if (!isNaN(Number(arr[i]))) {
					start = i;
					flag = true;
					break;
				}
			}
		}
		else {
			//первые операнды
			for (var i = arr.length - 1; i >= 0; i--) {
				if (!isNaN(Number(arr[i]))) {
					start = i;
					break;
				}
			}
		}

		while (arr[start] != undefined) {
			if (flag) {
				firstOperators(arr, start, index, result, firstLoop, helperVisJsArray);
				if (isNaN(Number(arr[start]))) {
					break;
				}
			}
			else {
				firstOperands(arr, start, index, result, firstLoop, helperVisJsArray);
				if (firstLoop) {
					start -= 2;
				}
				else {
					start -= 1;
				}
				if (isNaN(Number(arr[start]))) {
					break;
				}
			}
			firstLoop = false;
			index++;
		}

		// визуализация
		var nodes = new vis.DataSet();
		var edges = new vis.DataSet();

		for (var i = 0; i < helperVisJsArray.length; i++) {
			nodes.add({id: i, label: helperVisJsArray[i]});
		}
		for (var i = 0; i + 3 <= helperVisJsArray.length - 1; i+=3) {
			edges.add({from: i, to: i + 1});
			edges.add({from: i, to: i + 3, arrows: 'to'});
			edges.add({from: i + 2, to: i + 1});
			edges.add({from: i + 2, to: i + 3, arrows: 'to'});
		}
		var container = document.getElementById('or-graph');
		var data = {
			nodes: nodes,
			edges: edges,
		};
		var options = {};
		var network = new vis.Network(container, data, options);

		function firstOperators(arr, start, index, result, firstLoop, helperVisJsArray) {
			arr[start] = parseInt(arr[start]);
			(firstLoop) ? arr[start + 1] = parseInt(arr[start + 1]) : '';
			switch (arr[start - index]) {
				case '+':
					(firstLoop) ? result = arr[start] + arr[start + 1] : result += arr[start];
					break;
				case '-':
					(firstLoop) ? result = arr[start] - arr[start + 1] : result -= arr[start];
					break;
				case '*':
					(firstLoop) ? result = arr[start] * arr[start + 1] : result *= arr[start];
					break;
				case '/': 
					(firstLoop) ? result = arr[start] / arr[start + 1] : result /= arr[start];
					break;
				default:
					break;
			}
			if (firstLoop) {
				helperVisJsArray.push(arr[start], arr[start - index], arr[start + 1], result)
				arr.splice(start, 2)
			}
			else {
				helperVisJsArray.push(arr[start - index], arr[start], result);
				arr.splice(start, 1);
			}
			return result;
		}

		function firstOperands(arr, start, index, result, firstLoop, helperVisJsArray) {
			arr[start] = parseInt(arr[start]);
			(firstLoop) ? arr[start - 1] = parseInt(arr[start - 1]) : '';
			switch (arr[start + index]) {
				case '+':
					(firstLoop) ? result = arr[start] + arr[start - 1] : result += arr[start];
					break;
				case '-':
					(firstLoop) ? result = arr[start] - arr[start - 1] : result -= arr[start];
					break;
				case '*':
					(firstLoop) ? result = arr[start] * arr[start - 1] : result *= arr[start];
					break;
				case '/':
					(firstLoop) ? result = arr[start] / arr[start - 1] : result /= arr[start];
					break;
				default:
					break;
			}
			if (firstLoop) {
				helperVisJsArray.push(arr[start], arr[start + index], arr[start - 1], result)	
				arr.splice(start - 1, 2);
			}
			else {
				helperVisJsArray.push(arr[start + index], arr[start], result);
				arr.splice(start, 1)
			}
			return result;
		}
		function corrrectInput(string, rule) {
			if (string.match(rule)) {
				alert('Введены некоректные данные');
				window.location.reload();
			}
			else {
				return;
			}
		}
	</script>
</body>
</html>